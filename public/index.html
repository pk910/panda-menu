<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Menu - ethPandaOps Navigation</title>
    <script src="panda-menu.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e7;
            min-height: 100dvh;
            padding: 80px 24px 24px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }
        .subtitle {
            color: #a1a1aa;
            margin-bottom: 32px;
            font-size: 1.125rem;
            text-align: center;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .card h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: #f4f4f5;
        }
        .version-badge {
            display: inline-block;
            background: rgba(96, 165, 250, 0.2);
            color: #60a5fa;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 16px;
        }
        .code-block {
            background: #0d0d14;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        .code-block:last-child {
            margin-bottom: 0;
        }
        .code-block code {
            color: #a5b4fc;
        }
        .hash-table {
            width: 100%;
            border-collapse: collapse;
        }
        .hash-table th {
            text-align: left;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            font-weight: 500;
            font-size: 0.875rem;
            color: #a1a1aa;
        }
        .hash-table td {
            padding: 8px 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.75rem;
            word-break: break-all;
        }
        .hash-table tr:first-child td {
            border-top: none;
        }
        .loading {
            color: #a1a1aa;
            font-style: italic;
        }
        .error {
            color: #f87171;
        }
        .note {
            font-size: 0.875rem;
            color: #a1a1aa;
            margin-top: 12px;
        }
        .copy-btn {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.3);
            color: #60a5fa;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            margin-top: 8px;
            transition: background 0.2s;
        }
        .copy-btn:hover {
            background: rgba(96, 165, 250, 0.3);
        }
        .toggle-group {
            display: flex;
            gap: 8px;
        }
        .toggle-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #a1a1aa;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .toggle-btn.active {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.4);
            color: #60a5fa;
        }
        .toggle-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .toggle-btn:disabled:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        .toggle-btn svg {
            width: 24px;
            height: 24px;
        }
        .toggle-btn .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .toggle-btn.small {
            padding: 8px 12px;
        }
        .toggle-btn.small svg {
            width: 20px;
            height: 20px;
        }
        .sidebar-options {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .options-label {
            font-size: 0.75rem;
            color: #a1a1aa;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }
        .position-group {
            gap: 6px;
        }
        .open-menu-btn {
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .open-menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.4);
        }
        .open-menu-btn:active {
            transform: translateY(0);
        }
        .kbd {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Panda Menu</h1>
        <p class="subtitle">Cross-service navigation menu for ethPandaOps tools</p>

        <div style="display: flex; flex-direction: column; align-items: center; gap: 12px; margin-top: 24px; margin-bottom: 32px;">
            <button onclick="window.PandaMenu?.open()" class="open-menu-btn">Open Menu</button>
            <span style="color: #a1a1aa; font-size: 0.875rem;">
                or press <kbd class="kbd">Ctrl+M</kbd> to toggle
            </span>
        </div>

        <div class="card">
            <h2>Button Position</h2>
            <div class="toggle-group">
                <button id="btn-floating" class="toggle-btn active" onclick="setMenuMode('floating')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="8" height="8" rx="2"/>
                        <path d="M14 7h7M14 12h7M14 17h7M3 14h7M3 19h7"/>
                    </svg>
                    <span class="label">Floating</span>
                </button>
                <button id="btn-sidebar" class="toggle-btn" onclick="setMenuMode('sidebar')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="4" height="18" rx="1"/>
                        <path d="M10 8h11M10 12h11M10 16h11"/>
                    </svg>
                    <span class="label">Sidebar</span>
                </button>
                <button id="btn-hidden" class="toggle-btn" onclick="setMenuMode('hidden')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                        <line x1="1" y1="1" x2="23" y2="23"/>
                    </svg>
                    <span class="label">Hidden</span>
                </button>
            </div>
            <div id="sidebar-options" class="sidebar-options" style="display: none;">
                <p class="options-label">Side</p>
                <div class="toggle-group position-group">
                    <button id="btn-side-left" class="toggle-btn small active" onclick="setSidebarSide('left')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="4" height="18" rx="1"/>
                            <path d="M10 8h11M10 12h11M10 16h11"/>
                        </svg>
                        <span class="label">Left</span>
                    </button>
                    <button id="btn-side-top" class="toggle-btn small" onclick="setSidebarSide('top')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="4" rx="1"/>
                            <path d="M5 10v11M12 10v11M19 10v11"/>
                        </svg>
                        <span class="label">Top</span>
                    </button>
                    <button id="btn-side-right" class="toggle-btn small" onclick="setSidebarSide('right')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="17" y="3" width="4" height="18" rx="1"/>
                            <path d="M3 8h11M3 12h11M3 16h11"/>
                        </svg>
                        <span class="label">Right</span>
                    </button>
                    <button id="btn-side-bottom" class="toggle-btn small" onclick="setSidebarSide('bottom')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="17" width="18" height="4" rx="1"/>
                            <path d="M5 3v11M12 3v11M19 3v11"/>
                        </svg>
                        <span class="label">Bottom</span>
                    </button>
                </div>
                <p class="options-label" style="margin-top: 12px;">Position</p>
                <!-- Vertical position options (for left/right sides) -->
                <div id="vertical-positions" class="toggle-group position-group">
                    <button id="btn-pos-top" class="toggle-btn small" onclick="setSidebarPosition('top')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="4" height="6" rx="1"/>
                            <path d="M10 5h11M10 12h11M10 19h11"/>
                        </svg>
                        <span class="label">Top</span>
                    </button>
                    <button id="btn-pos-center" class="toggle-btn small active" onclick="setSidebarPosition('center')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="9" width="4" height="6" rx="1"/>
                            <path d="M10 5h11M10 12h11M10 19h11"/>
                        </svg>
                        <span class="label">Center</span>
                    </button>
                    <button id="btn-pos-bottom" class="toggle-btn small" onclick="setSidebarPosition('bottom')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="15" width="4" height="6" rx="1"/>
                            <path d="M10 5h11M10 12h11M10 19h11"/>
                        </svg>
                        <span class="label">Bottom</span>
                    </button>
                </div>
                <!-- Horizontal position options (for top side) -->
                <div id="horizontal-positions" class="toggle-group position-group" style="display: none;">
                    <button id="btn-pos-left" class="toggle-btn small" onclick="setSidebarPosition('left')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="6" height="4" rx="1"/>
                            <path d="M5 10v11M12 10v11M19 10v11"/>
                        </svg>
                        <span class="label">Left</span>
                    </button>
                    <button id="btn-pos-middle" class="toggle-btn small active" onclick="setSidebarPosition('center')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="3" width="6" height="4" rx="1"/>
                            <path d="M5 10v11M12 10v11M19 10v11"/>
                        </svg>
                        <span class="label">Middle</span>
                    </button>
                    <button id="btn-pos-right" class="toggle-btn small" onclick="setSidebarPosition('right')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="15" y="3" width="6" height="4" rx="1"/>
                            <path d="M5 10v11M12 10v11M19 10v11"/>
                        </svg>
                        <span class="label">Right</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Display Style</h2>
            <div class="toggle-group">
                <button id="btn-adjacent" class="toggle-btn active" onclick="setDisplayStyle('adjacent')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="6" height="6" rx="1"/>
                        <rect x="3" y="11" width="10" height="10" rx="1"/>
                    </svg>
                    <span class="label">Adjacent</span>
                </button>
                <button id="btn-modal" class="toggle-btn" onclick="setDisplayStyle('modal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="2" stroke-dasharray="3 2"/>
                        <rect x="6" y="7" width="12" height="10" rx="1"/>
                    </svg>
                    <span class="label">Modal</span>
                </button>
            </div>
            <p class="note">Adjacent: Menu appears next to the trigger. Modal: Menu appears centered with a darkened overlay.</p>
        </div>

        <div class="card">
            <h2>Menu Width</h2>
            <div class="toggle-group">
                <button id="btn-compact" class="toggle-btn" onclick="setMenuSize('compact')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="12" height="16" rx="1"/>
                        <path d="M9 8h6M9 12h6M9 16h4"/>
                    </svg>
                    <span class="label">Compact</span>
                </button>
                <button id="btn-normal" class="toggle-btn active" onclick="setMenuSize('normal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="4" y="3" width="16" height="18" rx="1"/>
                        <path d="M7 7h10M7 11h10M7 15h8"/>
                    </svg>
                    <span class="label">Normal</span>
                </button>
                <button id="btn-large" class="toggle-btn" onclick="setMenuSize('large')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="1"/>
                        <path d="M5 6h14M5 10h14M5 14h12M5 18h8"/>
                    </svg>
                    <span class="label">Large</span>
                </button>
                <button id="btn-xlarge" class="toggle-btn" onclick="setMenuSize('xlarge')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="1" width="22" height="22" rx="1"/>
                        <path d="M4 5h16M4 9h16M4 13h14M4 17h10M4 21h6"/>
                    </svg>
                    <span class="label">X Large</span>
                </button>
            </div>
            <p class="note">Compact: 356px, Normal: 420px, Large: 484px, X Large: 548px</p>
        </div>

        <div class="card">
            <h2>Latest Release</h2>
            <div id="version-info" class="loading">Loading version info...</div>
        </div>

        <div class="card">
            <h2>Embed Code</h2>
            <p class="note" style="margin-top: 0; margin-bottom: 12px;">Add this to your HTML to include the panda menu with your configuration:</p>
            <div id="embed-code" class="code-block loading">Loading...</div>
            <button class="copy-btn" onclick="copyEmbedCode()">Copy to clipboard</button>
        </div>

        <div class="card">
            <h2>Integrity Checksums</h2>
            <table class="hash-table">
                <thead>
                    <tr>
                        <th>Algorithm</th>
                        <th>Hash</th>
                    </tr>
                </thead>
                <tbody id="checksums">
                    <tr><td colspan="2" class="loading">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let baseScriptTag = '';
        let embedCodeContent = '';
        const BASE_URL = window.location.origin;

        async function loadVersionInfo() {
            try {
                const versionsRes = await fetch('versions.json');
                if (!versionsRes.ok) throw new Error('versions.json not found');

                const versions = await versionsRes.json();
                if (!versions.length) throw new Error('No versions available');

                const latestVersion = versions[0];

                const metadataRes = await fetch(`metadata-${latestVersion}.json`);
                if (!metadataRes.ok) throw new Error(`metadata-${latestVersion}.json not found`);

                const metadata = await metadataRes.json();

                document.getElementById('version-info').innerHTML = `
                    <span class="version-badge">v${metadata.version}</span>
                    <p style="margin-top: 8px;">
                        <strong>File:</strong> ${metadata.filename}<br>
                        <strong>Size:</strong> ${(metadata.size / 1024).toFixed(1)} KB<br>
                        <strong>Built:</strong> ${new Date(metadata.buildDate).toLocaleDateString()}
                    </p>
                `;

                baseScriptTag = `<script src="${BASE_URL}/${metadata.filename}" integrity="${metadata.integrity.sha384}" crossorigin="anonymous"><\/script>`;
                generateEmbedCode();

                document.getElementById('checksums').innerHTML = `
                    <tr><td>SHA-256</td><td>${metadata.integrity.sha256}</td></tr>
                    <tr><td>SHA-384</td><td>${metadata.integrity.sha384}</td></tr>
                    <tr><td>SHA-512</td><td>${metadata.integrity.sha512}</td></tr>
                `;
            } catch (err) {
                document.getElementById('version-info').innerHTML = `<span class="error">No releases available yet</span>`;
                baseScriptTag = `<script src="${BASE_URL}/panda-menu.js"><\/script>`;
                generateEmbedCode();
                document.getElementById('checksums').innerHTML = `<tr><td colspan="2" class="error">No release metadata available</td></tr>`;
            }
        }

        function escapeHtml(text) {
            return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function generateEmbedCode() {
            if (!baseScriptTag) return;

            // Check if using defaults
            const isDefault = currentMode === 'floating' &&
                              currentDisplayStyle === 'adjacent' &&
                              currentMenuSize === 'normal';

            if (isDefault) {
                embedCodeContent = baseScriptTag;
            } else {
                // Build config object with only non-default values
                const config = {};

                if (currentMode !== 'floating') {
                    config.menuMode = currentMode;
                }

                if (currentMode === 'sidebar') {
                    const sidebarConfig = {};
                    if (currentSide !== 'left') sidebarConfig.side = currentSide;
                    if (currentPosition !== 'center') sidebarConfig.position = currentPosition;
                    if (Object.keys(sidebarConfig).length > 0) {
                        config.sidebarConfig = sidebarConfig;
                    }
                }

                if (currentDisplayStyle !== 'adjacent' && currentMode !== 'hidden') {
                    config.displayStyle = currentDisplayStyle;
                }

                if (currentMenuSize !== 'normal') {
                    config.menuSize = currentMenuSize;
                }

                // Format config object nicely
                const configStr = JSON.stringify(config, null, 2)
                    .replace(/"([^"]+)":/g, '$1:')  // Remove quotes from keys
                    .replace(/"/g, "'");            // Use single quotes for values

                embedCodeContent = `<script>\nwindow.PandaMenuConfig = ${configStr};\n<\/script>\n${baseScriptTag}`;
            }

            document.getElementById('embed-code').innerHTML = `<code>${escapeHtml(embedCodeContent)}</code>`;
        }

        function copyEmbedCode() {
            navigator.clipboard.writeText(embedCodeContent).then(() => {
                const btn = document.querySelector('.copy-btn');
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = original, 2000);
            });
        }

        loadVersionInfo();

        // Read initial state from URL params
        const urlParams = new URLSearchParams(window.location.search);
        let currentMode = urlParams.get('mode') || 'floating';
        let currentPosition = urlParams.get('position') || 'center';
        let currentSide = urlParams.get('side') || 'left';
        let currentDisplayStyle = urlParams.get('display') || 'adjacent';
        let currentMenuSize = urlParams.get('size') || 'normal';

        // Validate params
        if (!['floating', 'sidebar', 'hidden'].includes(currentMode)) currentMode = 'floating';
        if (!['left', 'top', 'right', 'bottom'].includes(currentSide)) currentSide = 'left';
        if (!['top', 'center', 'bottom', 'left', 'right'].includes(currentPosition)) currentPosition = 'center';
        if (!['adjacent', 'modal'].includes(currentDisplayStyle)) currentDisplayStyle = 'adjacent';
        if (!['compact', 'normal', 'large', 'xlarge'].includes(currentMenuSize)) currentMenuSize = 'normal';

        function updateUrlParams() {
            const params = new URLSearchParams();
            params.set('mode', currentMode);
            params.set('display', currentDisplayStyle);
            params.set('size', currentMenuSize);
            if (currentMode === 'sidebar') {
                params.set('side', currentSide);
                params.set('position', currentPosition);
            }
            const newUrl = `${window.location.pathname}?${params.toString()}`;
            window.history.replaceState({}, '', newUrl);
        }

        function initializeUI() {
            // Set initial button states
            document.getElementById('btn-floating').classList.toggle('active', currentMode === 'floating');
            document.getElementById('btn-sidebar').classList.toggle('active', currentMode === 'sidebar');
            document.getElementById('btn-hidden').classList.toggle('active', currentMode === 'hidden');

            // Show/hide sidebar options
            document.getElementById('sidebar-options').style.display = currentMode === 'sidebar' ? 'block' : 'none';

            // Set side buttons
            document.getElementById('btn-side-left').classList.toggle('active', currentSide === 'left');
            document.getElementById('btn-side-top').classList.toggle('active', currentSide === 'top');
            document.getElementById('btn-side-right').classList.toggle('active', currentSide === 'right');
            document.getElementById('btn-side-bottom').classList.toggle('active', currentSide === 'bottom');

            // Show appropriate position options
            const isHorizontal = currentSide === 'top' || currentSide === 'bottom';
            document.getElementById('vertical-positions').style.display = isHorizontal ? 'none' : 'flex';
            document.getElementById('horizontal-positions').style.display = isHorizontal ? 'flex' : 'none';

            // Set position buttons
            updatePositionButtons();

            // Hidden mode forces modal display style
            if (currentMode === 'hidden') {
                currentDisplayStyle = 'modal';
                document.getElementById('btn-adjacent').disabled = true;
            }

            // Set display style buttons
            document.getElementById('btn-adjacent').classList.toggle('active', currentDisplayStyle === 'adjacent');
            document.getElementById('btn-modal').classList.toggle('active', currentDisplayStyle === 'modal');

            // Set menu size buttons
            document.getElementById('btn-compact').classList.toggle('active', currentMenuSize === 'compact');
            document.getElementById('btn-normal').classList.toggle('active', currentMenuSize === 'normal');
            document.getElementById('btn-large').classList.toggle('active', currentMenuSize === 'large');
            document.getElementById('btn-xlarge').classList.toggle('active', currentMenuSize === 'xlarge');

            // Render menu with initial settings
            if (window.PandaMenu) {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, currentMode, currentMode === 'sidebar' ? { position: currentPosition, side: currentSide } : undefined, currentDisplayStyle, currentMenuSize);
            }
        }

        // Initialize on load
        initializeUI();
        generateEmbedCode();

        function setMenuMode(mode) {
            if (mode === currentMode) return;

            currentMode = mode;

            // Update button states
            document.getElementById('btn-floating').classList.toggle('active', mode === 'floating');
            document.getElementById('btn-sidebar').classList.toggle('active', mode === 'sidebar');
            document.getElementById('btn-hidden').classList.toggle('active', mode === 'hidden');

            // Show/hide sidebar options
            document.getElementById('sidebar-options').style.display = mode === 'sidebar' ? 'block' : 'none';

            // Hidden mode forces modal display style, Sidebar defaults to adjacent
            if (mode === 'hidden') {
                currentDisplayStyle = 'modal';
                document.getElementById('btn-adjacent').classList.remove('active');
                document.getElementById('btn-adjacent').disabled = true;
                document.getElementById('btn-modal').classList.add('active');
            } else {
                document.getElementById('btn-adjacent').disabled = false;
                if (mode === 'sidebar' || mode === 'floating') {
                    currentDisplayStyle = 'adjacent';
                    document.getElementById('btn-adjacent').classList.add('active');
                    document.getElementById('btn-modal').classList.remove('active');
                }
            }

            // Cleanup existing menu and re-render with new mode
            if (window.PandaMenu) {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, mode, mode === 'sidebar' ? { position: currentPosition, side: currentSide } : undefined, currentDisplayStyle, currentMenuSize);
            }

            updateUrlParams();
            generateEmbedCode();
        }

        function setDisplayStyle(style) {
            if (style === currentDisplayStyle) return;

            currentDisplayStyle = style;

            // Update button states
            document.getElementById('btn-adjacent').classList.toggle('active', style === 'adjacent');
            document.getElementById('btn-modal').classList.toggle('active', style === 'modal');

            // Cleanup existing menu and re-render with new display style
            if (window.PandaMenu) {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, currentMode, currentMode === 'sidebar' ? { position: currentPosition, side: currentSide } : undefined, style, currentMenuSize);
            }

            updateUrlParams();
            generateEmbedCode();
        }

        function setMenuSize(size) {
            if (size === currentMenuSize) return;

            currentMenuSize = size;

            // Update button states
            document.getElementById('btn-compact').classList.toggle('active', size === 'compact');
            document.getElementById('btn-normal').classList.toggle('active', size === 'normal');
            document.getElementById('btn-large').classList.toggle('active', size === 'large');
            document.getElementById('btn-xlarge').classList.toggle('active', size === 'xlarge');

            // Cleanup existing menu and re-render with new size
            if (window.PandaMenu) {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, currentMode, currentMode === 'sidebar' ? { position: currentPosition, side: currentSide } : undefined, currentDisplayStyle, size);
            }

            updateUrlParams();
            generateEmbedCode();
        }

        function setSidebarSide(side) {
            if (side === currentSide) return;

            currentSide = side;

            // Update side button states
            document.getElementById('btn-side-left').classList.toggle('active', side === 'left');
            document.getElementById('btn-side-top').classList.toggle('active', side === 'top');
            document.getElementById('btn-side-right').classList.toggle('active', side === 'right');
            document.getElementById('btn-side-bottom').classList.toggle('active', side === 'bottom');

            // Show appropriate position options
            const isHorizontal = side === 'top' || side === 'bottom';
            document.getElementById('vertical-positions').style.display = isHorizontal ? 'none' : 'flex';
            document.getElementById('horizontal-positions').style.display = isHorizontal ? 'flex' : 'none';

            // Reset position to center when switching sides
            currentPosition = 'center';
            updatePositionButtons();

            // Re-render sidebar with new side
            if (window.PandaMenu && currentMode === 'sidebar') {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, 'sidebar', { position: currentPosition, side: side }, currentDisplayStyle, currentMenuSize);
            }

            updateUrlParams();
            generateEmbedCode();
        }

        function setSidebarPosition(position) {
            if (position === currentPosition) return;

            currentPosition = position;
            updatePositionButtons();

            // Re-render sidebar with new position
            if (window.PandaMenu && currentMode === 'sidebar') {
                window.PandaMenu.cleanup();
                window.PandaMenu.render(null, 'sidebar', { position: position, side: currentSide }, currentDisplayStyle, currentMenuSize);
            }

            updateUrlParams();
            generateEmbedCode();
        }

        function updatePositionButtons() {
            // Vertical position buttons
            document.getElementById('btn-pos-top').classList.toggle('active', currentPosition === 'top');
            document.getElementById('btn-pos-center').classList.toggle('active', currentPosition === 'center');
            document.getElementById('btn-pos-bottom').classList.toggle('active', currentPosition === 'bottom');

            // Horizontal position buttons
            document.getElementById('btn-pos-left').classList.toggle('active', currentPosition === 'left');
            document.getElementById('btn-pos-middle').classList.toggle('active', currentPosition === 'center');
            document.getElementById('btn-pos-right').classList.toggle('active', currentPosition === 'right');
        }
    </script>
</body>
</html>
